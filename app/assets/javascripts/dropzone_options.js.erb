$('.uploads.new').ready(function () {
	id = 1;

 	// disable auto discover
	Dropzone.autoDiscover = false;

 	var dropzone = new Dropzone( ".dropzone", {
		maxFilesize: 50, // Set the maximum file size to 50 MB
		maxThumbnailFilesize: 50,
		paramName: "file", // Rails expects the file upload to be something like model[field_name]
		addRemoveLinks: false, // Don't show remove links on dropzone itself.
		acceptedFiles: 'image/*',
		dictDefaultMessage: "Drag Images or Click Here to Upload",
		clickable: "#clickable",
		thumbnailHeight: 210,
		thumbnailWidth: null,
		previewTemplate: document.querySelector('#preview-template').innerHTML,
		previewsContainer: "#upload-previews"
	});

	// Update the total progress bar
	dropzone.on("totaluploadprogress", function(progress) {
	  $('.dz-upload').width = progress + "%";
	});

	dropzone.on("addedfile", function() {
		id++;
		$(".dz-message, #clickable").hide();
  	$("#uploader-controls").removeClass("hidden");
  	$("#remove-all-uploads").removeClass("hidden");
  	$("#upload_tag_list").attr('id', "upload-" + id);
		formatTags("#upload-" + id);
	});

	dropzone.on("sending", function(file, xhr, formData) {
	  // Will send the content type along with the file as POST data.
	  formData.append("Content-Type", file.type);
	});

  return dropzone.on("success", function(file, responseText) {
  	var direct_url = $(responseText).find("location")[0];
  	var url_location = $(direct_url).text();
  	$("#save-uploads").removeClass("hidden");

	  $("#save-uploads").click(function() {
	  	var tags = getTags($(".tag-data").get());
	    $.post( "/uploads", { upload: {direct_upload_url: url_location, tag_list: tags} });
	  });

	  $("#remove-all-uploads").click(function() {
	  	dropzone.removeAllFiles(true);
	  });
  });

  

});